<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="homepage.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>

<body>

    <div class="layout">
        <div class="sidebar">
            <ul class="components">
                <li>
                    <a href="#">
                        <span class="icon dashicon"><i class="fa-solid fa-info"></i></span>
                        <span class="components">Dashboard</span></a>
                </li>
                <li>

                <li>
                    <a href="#">
                        <span class="icon helpicon"><i class="fa-solid fa-info"></i></span>
                        <span class="components">Support & Help</span></a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon settingicon"><i class="fa-solid fa-gear"></i></span>
                        <span class="components">Settings</span></a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon logouticon"><i class="fa-solid fa-arrow-right-from-bracket"></i></span>
                        <span class="components">Logout</span></a>
                </li>

            </ul>
        </div>
        <div class="content">

            <section class="main">
                <h1>Dashboard</h1>
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <div class="col">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">Total Patients</h5>
                                <p class="card-text">50</p>
                            </div>
                        </div>
                    </div>
            </section>

            <section class="main px-4 py-4">
                <h1 class="mb-3">Upcoming Appointments</h1>
                <p class="text-muted">Manage your patient appointments</p>

                <!-- Carousel Wrapper -->
                <div id="appointmentCarousel" class="carousel slide">
                    <div class="carousel-inner">

                        <!-- Page 1 -->
                        <div class="carousel-item active">
                            <div class="row row-cols-1 row-cols-md-3 g-4">
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Mohamed Mostafa <span class="badge bg-secondary"
                                                    style=" color: aliceblue;">Completed</span>
                                            </h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Khadija Elfeky<span
                                                    class="badge bg-secondary">Scheduled</span></h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">
                                                Hamza-Elghonemy
                                                <span class="badge bg-secondary">Scheduled</span>
                                            </h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Page 2 -->
                        <div class="carousel-item">
                            <div class="row row-cols-1 row-cols-md-3 g-4">
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Caroline Ehab <span
                                                    class="badge bg-secondary">Scheduled</span></h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Add 2 more cards here for page 1 -->
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Patthy <span
                                                    class="badge bg-secondary">Scheduled</span></h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Amanda Davis <span
                                                    class="badge bg-secondary">Scheduled</span></h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Page 3 -->
                        <div class="carousel-item">
                            <div class="row row-cols-1 row-cols-md-3 g-4">
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Joe Shmoe<span
                                                    class="badge bg-secondary">Scheduled</span></h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Emma Johnson<span
                                                    class="badge bg-secondary">Scheduled</span></h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Johnson <span
                                                    class="badge bg-secondary">Scheduled</span></h5>
                                            <p class="card-text"><i class="bi bi-calendar-event"></i> Today</p>
                                            <p class="card-text"><i class="bi bi-clock"></i> 10:00 AM</p>
                                            <p class="card-text"><i class="bi bi-telephone"></i> (555) 123-4567</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Navigation Controls -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#appointmentCarousel"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#appointmentCarousel"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    </button>
                </div>
            </section>
        </div>


    </div>
    <canvas id="chart" width="400" height="200"></canvas>
    <script>
        const ctx = document.getElementById('chart').getContext('2d');
        const labels = [];
        const data = {
            labels: labels,
            datasets: [{
                label: 'Sensor Data',
                data: [],
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        };
        const config = {
            type: 'line',
            data: data,
            options: {
                animation: false,
                scales: {
                    x: { title: { display: true, text: 'Time' } },
                    y: { title: { display: true, text: 'Value' } }
                }
            }
        };
        const myChart = new Chart(ctx, config);

        const socket = io();
        let lastArrhythmicState = null; // Track last known state
        let lastToastTime = 0; // Track when we last showed a toast
        const toastCooldown = 30000; // Only show one toast every 10 seconds minimum

        socket.on('arduinoData', function (val) {
            const now = new Date();
            const currentTime = now.getTime();
            const timeString = now.toLocaleTimeString();

            if (labels.length > 40) {
                labels.shift();
                data.datasets[0].data.shift();
            }

            labels.push(timeString);
            data.datasets[0].data.push(parseFloat(val[0]));

            // Only show toast if state changed AND we haven't shown one recently
            const currentState = val[1] == 1 ? 'arrhythmic' : 'normal';

            if (currentState !== lastArrhythmicState &&
                (currentTime - lastToastTime > toastCooldown)) {

                if (currentState === 'arrhythmic') {
                    Toastify({
                        text: "Patient is Arrhythmic",
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: "red",
                    }).showToast();
                } else {
                    Toastify({
                        text: "Patient is Normal",
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: "green",
                    }).showToast();
                }

                // Update tracking variables
                lastToastTime = currentTime;
                lastArrhythmicState = currentState;
            }

            myChart.update();
        });

    </script>


</body>

</html>